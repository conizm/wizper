<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Wizper - Home</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600&family=Lato:wght@300;400&family=Playfair+Display:ital@0;1&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Lato', sans-serif;
            background-color: #1a1a1a;
            color: #f9f9f7;
            -webkit-tap-highlight-color: transparent;
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        h1, h2, .font-serif {
            font-family: 'Cinzel', serif;
        }
        .font-script {
            font-family: 'Playfair Display', serif;
            font-style: italic;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes floatUp {
            0% { 
                opacity: 0;
                transform: translateY(20px);
            }
            100% { 
                opacity: 1;
                transform: translateY(0);
            }
        }

        .anim-fade-in {
            opacity: 0;
            animation: fadeIn 2.0s ease-out forwards;
        }

        .anim-fade-in-bg {
            opacity: 0;
            animation: fadeIn 5.0s ease-out forwards;
        }

        .glass-float-container {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(5px);             
            -webkit-backdrop-filter: blur(5px);     
            border: 1px solid rgba(255, 255, 255, 0.15);
            opacity: 0;
            animation: floatUp 1.5s ease-out forwards;
            transform: translateZ(0); 
        }

        .overlay-container {
            position: absolute;
            inset: 0;
            z-index: 50;
            background-color: rgba(26, 26, 26, 0.98);
            padding-top: max(3rem, env(safe-area-inset-top));
            padding-bottom: env(safe-area-inset-bottom, 20px);
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease-out;
        }
        
        .overlay-container.active {
            opacity: 1;
            pointer-events: auto;
        }
        
        .custom-scroll::-webkit-scrollbar {
            width: 4px;
        }
        .custom-scroll::-webkit-scrollbar-track {
            background: transparent;
        }
        .custom-scroll::-webkit-scrollbar-thumb {
            background: #444; 
            border-radius: 2px;
        }
        
        .mb-safe {
            margin-bottom: env(safe-area-inset-bottom, 20px);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        const FIREBASE_CONFIG = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        let auth = null;
        let db = null;
        let googleProvider = null;

        try {
            if (firebase.apps.length === 0 && FIREBASE_CONFIG.apiKey !== "YOUR_API_KEY") {
                firebase.initializeApp(FIREBASE_CONFIG);
                auth = firebase.auth();
                db = firebase.firestore();
                googleProvider = new firebase.auth.GoogleAuthProvider();
            }
        } catch (e) {
            console.error("Firebase init error:", e);
        }

        const SettingsIcon = ({ size = 20 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"></path><circle cx="12" cy="12" r="3"></circle></svg>
        );
        const BookIcon = ({ size = 20 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>
        );
        const LockIcon = ({ size = 16 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
        );
        const EarIcon = ({ size = 20 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><path d="M6 9a6 6 0 0 1 12 0v5"/><path d="M18 19a3 3 0 0 1-6 0v-2h6v2z"/><path d="M6 19v-2h6"/></svg>
        );
        const CoffeeIcon = ({ size = 18 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"><path d="M18 8h1a4 4 0 0 1 0 8h-1"/><path d="M2 8h16v9a4 4 0 0 1-4 4H6a4 4 0 0 1-4-4V8z"/><line x1="6" y1="1" x2="6" y2="4"/><line x1="10" y1="1" x2="10" y2="4"/><line x1="14" y1="1" x2="14" y2="4"/></svg>
        );
        const GoogleIcon = ({ size = 16 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="currentColor"><path d="M12.48 10.92v3.28h7.84c-.24 1.84-.853 3.187-1.787 4.133-1.147 1.147-2.933 2.4-6.053 2.4-4.827 0-8.6-3.893-8.6-8.72s3.773-8.72 8.6-8.72c2.6 0 4.507 1.027 5.907 2.347l2.307-2.307C18.747 1.44 16.133 0 12.48 0 5.867 0 .533 5.347.533 12S5.867 24 12.48 24c3.44 0 6.04-1.133 8.133-3.293 2.147-2.147 2.813-5.173 2.813-7.627 0-.76-.08-1.467-.173-2.16H12.48z"/></svg>
        );

        const CHAPTER_DEFINITIONS = [
            { id: 1, title: "The Master's Desk", sub: "Study Room" },
            { id: 2, title: "Greenhouse", sub: "Herbs & Roots" },
            { id: 3, title: "Midnight Market", sub: "Rare Artifacts" },
            { id: 4, title: "Ritual Chamber", sub: "The Grand Spell" },
        ];

        const Menu = () => {
            const [view, setView] = useState('main'); 
            const [showTransition, setShowTransition] = useState(false);
            const [subtitles, setSubtitles] = useState(false);
            const [isInitialLoad, setIsInitialLoad] = useState(true);

            const [user, setUser] = useState(null);
            const [clearedChapters, setClearedChapters] = useState([1]); 
            const [loadingAuth, setLoadingAuth] = useState(true);

            useEffect(() => {
                const timer = setTimeout(() => {
                    setIsInitialLoad(false);
                }, 6000); 
                return () => clearTimeout(timer);
            }, []);

            useEffect(() => {
                if (!auth) {
                    setLoadingAuth(false);
                    return;
                }
                const unsubscribe = auth.onAuthStateChanged(async (currentUser) => {
                    setUser(currentUser);
                    if (currentUser) {
                        try {
                            const docRef = db.collection("users").doc(currentUser.uid);
                            const doc = await docRef.get();
                            if (doc.exists) {
                                const data = doc.data();
                                if (data.clearedChapters) {
                                    setClearedChapters(data.clearedChapters);
                                }
                            } else {
                                await docRef.set({ clearedChapters: [1] }, { merge: true });
                            }
                        } catch (err) {
                            console.error("Error fetching progress:", err);
                        }
                    }
                    setLoadingAuth(false);
                });
                return () => unsubscribe();
            }, []);

            const handleLogin = async () => {
                if (!auth) {
                    alert("Firebase API Key is missing in code.");
                    return;
                }
                try {
                    await auth.signInWithPopup(googleProvider);
                } catch (error) {
                    console.error("Login failed:", error);
                }
            };

            const handleLogout = async () => {
                if (auth) {
                    await auth.signOut();
                    setClearedChapters([1]); 
                }
            };

            const handleStartGame = () => {
                setShowTransition(true);
                setTimeout(() => {
                    console.log("Navigating...");
                    setShowTransition(false);
                }, 1000);
            };

            const getGlassClass = () => isInitialLoad ? 'glass-float-container' : 'glass-float-container !animate-none !opacity-100';
            const getFadeClass = (animClass) => isInitialLoad ? animClass : 'opacity-100';

            return (
                <div className="relative w-full h-[100dvh] flex flex-col justify-between py-12 px-6 overflow-hidden">
                    
                    <div className={`absolute inset-0 z-0 pointer-events-none ${getFadeClass('anim-fade-in-bg')}`} style={isInitialLoad ? {animationDelay: '0s'} : {}}>
                        <img 
                            src="https://images.unsplash.com/photo-1535905557558-afc4877a26fc?q=80&w=2400&auto=format&fit=crop" 
                            alt="Background" 
                            className="w-full h-full object-cover opacity-40 grayscale"
                        />
                        <div className="absolute inset-0 bg-gradient-to-b from-[#1a1a1a] via-transparent to-[#1a1a1a]"></div>
                    </div>

                    <div 
                        className={`z-10 text-center mt-8 shrink-0 ${getFadeClass('anim-fade-in')}`}
                        style={isInitialLoad ? {animationDelay: '1.5s'} : {}}
                    >
                        <p className="text-[10px] tracking-[0.4em] uppercase text-gray-400 mb-4">Audio Hidden Object Game</p>
                        <h1 className="text-5xl md:text-7xl font-serif text-[#f9f9f7] tracking-wider mb-2">Wizper</h1>
                        <p className="font-script text-xl text-gray-400 italic opacity-80">- The Apprentice's Log -</p>
                    </div>

                    <div className="z-10 w-full max-w-md mx-auto mb-safe flex flex-col items-center gap-6">
                        
                        <div className="w-full flex flex-col items-center gap-6">
                            
                            <p 
                                className={`text-xs text-center leading-relaxed text-gray-400 max-w-xs font-serif italic ${getFadeClass('anim-fade-in')}`} 
                                style={isInitialLoad ? {animationDelay: '2.5s'} : {}}
                            >
                                "Listen carefully, apprentice.<br/>My eyes aren't what they used to be..."
                            </p>

                            <div className="w-full">
                                <button 
                                    onClick={handleStartGame}
                                    className={`w-full py-4 hover:bg-white/10 transition-colors text-sm tracking-[0.2em] uppercase font-serif text-[#f9f9f7] ${getGlassClass()}`}
                                    style={isInitialLoad ? {animationDelay: '2.8s'} : {}}
                                >
                                    Open Journal
                                </button>
                            </div>
                            
                            <div 
                                className={`flex gap-4 w-full ${getFadeClass('anim-fade-in')}`} 
                                style={isInitialLoad ? {animationDelay: '3.0s'} : {}}
                            >
                                <button 
                                    onClick={() => setView('chapters')}
                                    className="flex-1 py-3 border border-white/10 hover:bg-white/5 transition-colors text-xs tracking-widest uppercase flex justify-center items-center gap-2"
                                >
                                    <BookIcon size={14} /> Log
                                </button>
                                <button 
                                    onClick={() => setView('howto')}
                                    className="flex-1 py-3 border border-white/10 hover:bg-white/5 transition-colors text-xs tracking-widest uppercase flex justify-center items-center gap-2"
                                >
                                    <EarIcon size={14} /> Guide
                                </button>
                            </div>
                            
                            <div 
                                className={`${getFadeClass('anim-fade-in')}`} 
                                style={isInitialLoad ? {animationDelay: '3.2s'} : {}}
                            >
                                <button 
                                    onClick={() => setView('settings')}
                                    className="mt-2 text-gray-500 hover:text-white transition-colors"
                                >
                                    <SettingsIcon size={18} />
                                </button>
                            </div>
                        </div>
                    </div>

                    <div className={`overlay-container flex flex-col ${view === 'chapters' ? 'active' : ''}`}>
                        <div className="flex justify-between items-center px-8 pb-4 border-b border-white/10 shrink-0">
                            <h2 className="text-lg font-serif tracking-widest">Journal Log</h2>
                            <button onClick={() => setView('main')} className="text-xs uppercase tracking-widest text-gray-400 p-2">Close</button>
                        </div>
                        <div className="flex-1 overflow-y-auto custom-scroll flex flex-col gap-4 p-8">
                            <p className="text-xs text-gray-500 font-serif italic mb-2 text-center">Record of assigned tasks.</p>
                            
                            {CHAPTER_DEFINITIONS.map(chapter => {
                                const maxCleared = Math.max(0, ...clearedChapters);
                                const locked = chapter.id > maxCleared + (maxCleared < chapter.id ? 0 : 1); 
                                
                                return (
                                    <div key={chapter.id} className={`p-4 border ${locked ? 'border-white/5 text-gray-600' : 'border-white/20 bg-white/5'} transition-all`}>
                                        <div className="flex justify-between items-start mb-1">
                                            <span className="text-[10px] uppercase tracking-widest opacity-50">Chapter {chapter.id}</span>
                                            {locked ? <LockIcon size={12}/> : <span className="text-[10px] text-gray-400">Complete</span>}
                                        </div>
                                        <h3 className="font-serif text-lg mb-1">{chapter.title}</h3>
                                        <p className="font-script text-sm italic opacity-60">{chapter.sub}</p>
                                    </div>
                                );
                            })}
                        </div>
                    </div>

                    <div className={`overlay-container flex flex-col ${view === 'howto' ? 'active' : ''}`}>
                        <div className="flex justify-between items-center px-8 pb-4 border-b border-white/10 shrink-0">
                            <h2 className="text-lg font-serif tracking-widest">Guide</h2>
                            <button onClick={() => setView('main')} className="text-xs uppercase tracking-widest text-gray-400 p-2">Close</button>
                        </div>
                        <div className="flex-1 overflow-y-auto custom-scroll p-6 flex flex-col justify-start pt-12 items-center">
                            <div className="flex flex-col gap-8 items-center text-center">
                                <div className="max-w-xs shrink-0">
                                    <p className="text-sm text-gray-400 italic mb-2">"Find the hidden objects."</p>
                                </div>
                                <div className="flex flex-col gap-6 w-full max-w-xs px-2">
                                    <div className="flex items-center gap-5 text-left">
                                        <div className="w-12 h-12 rounded-full border border-white/20 flex items-center justify-center shrink-0">
                                            <EarIcon size={20} />
                                        </div>
                                        <div>
                                            <h3 className="text-xs font-bold uppercase tracking-widest mb-1">Listen</h3>
                                            <p className="text-xs text-gray-400 font-serif italic">Hear the voice instructions.</p>
                                        </div>
                                    </div>
                                    <div className="flex items-center gap-5 text-left">
                                        <div className="w-12 h-12 rounded-full border border-white/20 flex items-center justify-center shrink-0">
                                            <svg xmlns="http://www.w3.org/2000/svg" width={20} height={20} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/></svg>
                                        </div>
                                        <div>
                                            <h3 className="text-xs font-bold uppercase tracking-widest mb-1">Search</h3>
                                            <p className="text-xs text-gray-400 font-serif italic">Pinch to zoom. Swipe to pan.</p>
                                        </div>
                                    </div>
                                    <div className="flex items-center gap-5 text-left">
                                        <div className="w-12 h-12 rounded-full border border-white/20 flex items-center justify-center shrink-0">
                                            <svg xmlns="http://www.w3.org/2000/svg" width={20} height={20} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="1.5"><path d="M14 9V5a3 3 0 0 0-3-3l-4 9v11h11.28a2 2 0 0 0 2-1.7l1.38-9a2 2 0 0 0-2-2.3zM7 22H4a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3"/></svg>
                                        </div>
                                        <div>
                                            <h3 className="text-xs font-bold uppercase tracking-widest mb-1">Select</h3>
                                            <p className="text-xs text-gray-400 font-serif italic">Double tap to collect the object.</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div className={`overlay-container flex flex-col ${view === 'settings' ? 'active' : ''}`}>
                        <div className="flex justify-between items-center px-8 pb-4 border-b border-white/10 shrink-0">
                            <h2 className="text-lg font-serif tracking-widest">Settings</h2>
                            <button onClick={() => setView('main')} className="text-xs uppercase tracking-widest text-gray-400 p-2">Close</button>
                        </div>
                        <div className="flex-1 overflow-y-auto custom-scroll p-8 flex flex-col gap-8">
                            
                            <div className="flex flex-col gap-3">
                                <span className="text-sm tracking-widest mb-2">Cloud Save</span>
                                {user ? (
                                    <div className="p-4 border border-white/10 bg-white/5 flex flex-col gap-2">
                                        <div className="flex items-center gap-3">
                                            <div className="w-8 h-8 rounded-full bg-gray-700 overflow-hidden">
                                                {user.photoURL && <img src={user.photoURL} alt="User" />}
                                            </div>
                                            <div>
                                                <p className="text-xs text-white">{user.displayName}</p>
                                                <p className="text-[10px] text-gray-400">Progress Saved</p>
                                            </div>
                                        </div>
                                        <button onClick={handleLogout} className="text-[10px] text-red-400 underline self-start mt-1">Sign Out</button>
                                    </div>
                                ) : (
                                    <div className="flex flex-col gap-2">
                                        <button 
                                            onClick={handleLogin}
                                            className="flex items-center justify-center gap-3 w-full py-3 border border-white/20 hover:bg-white/5 text-gray-300 transition-colors"
                                        >
                                            <GoogleIcon size={16} />
                                            <span className="text-xs font-bold uppercase tracking-widest">Sign in with Google</span>
                                        </button>
                                        <p className="text-[10px] text-gray-500 italic">
                                            Sign in to save your progress across devices.
                                        </p>
                                    </div>
                                )}
                            </div>

                            <div className="h-px bg-white/50 w-full"></div>

                            <div className="flex flex-col gap-3">
                                <div className="flex justify-between items-center">
                                    <span className="text-sm tracking-widest">Subtitles</span>
                                    <button 
                                        onClick={() => setSubtitles(!subtitles)}
                                        className={`text-xs px-3 py-1 border transition-all ${subtitles ? 'bg-white text-black border-white' : 'text-gray-400 border-gray-600'}`}
                                    >
                                        {subtitles ? 'ON' : 'OFF'}
                                    </button>
                                </div>
                                <p className="text-[10px] text-gray-500 italic leading-relaxed">
                                    * We recommend playing with subtitles OFF for the best immersive experience.
                                </p>
                            </div>

                            <div className="h-px bg-white/50 w-full"></div>

                            <div className="flex flex-col gap-6 items-center mt-4">
                                <a href="#" className="text-xs text-gray-500 hover:text-white underline underline-offset-4 decoration-gray-700 transition-colors">
                                    Privacy Policy
                                </a>

                                <button className="flex items-center gap-3 px-6 py-3 border border-yellow-700/50 text-yellow-600 hover:bg-yellow-900/10 hover:text-yellow-500 transition-all rounded-sm group">
                                    <CoffeeIcon size={16} />
                                    <span className="text-xs uppercase tracking-widest">Gift a Coffee</span>
                                </button>
                            </div>

                            <div className="mt-auto pt-8 text-center">
                                <p className="text-[10px] text-gray-700 font-mono">v0.2.0 Cloud</p>
                            </div>
                        </div>
                    </div>

                    {showTransition && (
                        <div className="absolute inset-0 bg-black z-50 animate-fade-in flex items-center justify-center">
                            <p className="text-white font-serif tracking-widest animate-pulse opacity-80">Opening Journal...</p>
                        </div>
                    )}

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Menu />);
    </script>
</body>
</html>


